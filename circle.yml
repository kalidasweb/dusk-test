machine:
  pre:
    - sudo apt-get update; USE_PRECOMPILE=true sudo -E circleci-install php 7.1.0
    - sudo apt-get install --only-upgrade google-chrome-stable
  php:
    version: 7.1.0
  timezone: America/Los_Angeles
  services:
    - mysql
  environment:
      APP_ENV: testing
      APP_KEY: randomrandomrandomrandomrandom12
  post:
    - chromedriver:
        background: true

dependencies:
  override:
    - composer install --prefer-dist --no-interaction
  post:
    - mv .env.example .env

test:
  override:
    - vendor/bin/phpunit
    - ./vendor/laravel/dusk/bin/chromedriver-linux:
    - php artisan serve --host=localhost --port=8080:
          background: true
    - php artisan dusk
